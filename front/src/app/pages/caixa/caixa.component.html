<p-card header="Caixa - Registro de Venda">
    <div class="grid">

        <div class="col-12 md:col-7">
            
            <p-toolbar>
                <div class="p-toolbar-group-left">
                    <i class="pi pi-shopping-cart mr-2"></i>
                    <span class="font-bold">Itens da Venda</span>
                </div>
            </p-toolbar>

            <p-table [value]="itensVenda" responsiveLayout="scroll">
                <ng-template pTemplate="header">
                    <tr>
                        <th>Produto</th>
                        <th>Qtd.</th>
                        <th>Preço Unit.</th>
                        <th>Subtotal</th>
                        <th>Ação</th>
                    </tr>
                </ng-template>
                <ng-template pTemplate="body" let-item>
                    <tr>
                        <td>{{item.produto.nome}}</td>
                        <td>{{item.quantidade}}</td>
                        <td>{{item.precoUnitario | currency:'BRL'}}</td>
                        <td>{{item.subtotal | currency:'BRL'}}</td>
                        <td>
                            <p-button icon="pi pi-trash" 
                                      styleClass="p-button-rounded p-button-danger"
                                      (click)="removerItem(item.produto.id)">
                            </p-button>
                        </td>
                    </tr>
                </ng-template>
                <ng-template pTemplate="emptymessage">
                    <tr>
                        <td colspan="5">Nenhum item adicionado à venda.</td>
                    </tr>
                </ng-template>
            </p-table>

        </div>

        <div class="col-12 md:col-5">
            
            <p-card header="Adicionar Item">
                <form [formGroup]="itemForm" (ngSubmit)="adicionarItem()">
                    <div class="field">
                        <label for="produto">Buscar Produto</label>
                        <p-autoComplete 
                            id="produto"
                            formControlName="produto"
                            [suggestions]="produtosSugeridos" 
                            (completeMethod)="buscarProdutos($event)"
                            field="nome" 
                            [dropdown]="true"
                            [forceSelection]="true"
                            placeholder="Digite o nome do produto"
                            styleClass="w-full">
                        </p-autoComplete>
                    </div>
                    
                    <div class="field">
                        <label for="quantidade">Quantidade</label>
                        <p-inputNumber id="quantidade" 
                                       formControlName="quantidade" 
                                       [min]="1" 
                                       [showButtons]="true"
                                       styleClass="w-full">
                        </p-inputNumber>
                    </div>

                    <p-button label="Adicionar" 
                              icon="pi pi-plus" 
                              type="submit" 
                              [disabled]="itemForm.invalid">
                    </p-button>
                </form>
            </p-card>

            <p-card header="Totalizar Venda" styleClass="mt-3">
                <div classs="formgrid grid">
                    <div class="field col-12">
                        <label>Total da Venda (R$)</label>
                        <input pInputText 
                               [value]="totalVenda | currency:'BRL'" 
                               [disabled]="true" 
                               class="w-full text-3xl text-primary font-bold" />
                    </div>
                    <div class="field col-12">
                        <label for="valorRecebido">Valor Recebido (R$)</label>
                        <p-inputNumber id="valorRecebido" 
                                       [(ngModel)]="valorRecebido"
                                       (onInput)="calcularTroco()"
                                       mode="currency" 
                                       currency="BRL" 
                                       locale="pt-BR"
                                       styleClass="w-full">
                        </p-inputNumber>
                    </div>
                    <div class="field col-12">
                        <label>Troco (R$)</label>
                        <input pInputText 
                               [value]="troco | currency:'BRL'" 
                               [disabled]="true" 
                               class="w-full font-bold" />
                    </div>
                </div>

                <div class="flex gap-2 mt-3">
                    <p-button label="Finalizar Venda" 
                              icon="pi pi-check" 
                              styleClass="p-button-success"
                              (click)="finalizarVenda()"
                              [disabled]="!valorRecebido || valorRecebido < totalVenda">
                    </p-button>
                    <p-button label="Cancelar" 
                              icon="pi pi-times" 
                              styleClass="p-button-danger p-button-outlined"
                              (click)="cancelarVenda()">
                    </p-button>
                </div>
            </p-card>
        </div>

    </div>
</p-card>